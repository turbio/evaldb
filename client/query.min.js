var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}
function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}
function _instanceof(a,b){$jscomp.initSymbol();$jscomp.initSymbol();return null!=b&&"undefined"!==typeof Symbol&&b[Symbol.hasInstance]?($jscomp.initSymbol(),!!b[Symbol.hasInstance](a)):a instanceof b}
function _typeof(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return _typeof(a)}
function _defineProperty(a,b,c){b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c;return a}function _classCallCheck(a,b){if(!_instanceof(a,b))throw new TypeError("Cannot call a class as a function");}function _defineProperties(a,b){for(var c=0;c<b.length;c++){var k=b[c];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(a,k.key,k)}}
function _createClass(a,b,c){b&&_defineProperties(a.prototype,b);c&&_defineProperties(a,c);return a}function _possibleConstructorReturn(a,b){return!b||"object"!==_typeof(b)&&"function"!==typeof b?_assertThisInitialized(a):b}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}
function _getPrototypeOf(a){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return _getPrototypeOf(a)}function _inherits(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});b&&_setPrototypeOf(a,b)}
function _setPrototypeOf(a,b){_setPrototypeOf=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return _setPrototypeOf(a,b)}
var e=React.createElement,funcSyntax={luaval:{headOpen:"function(",headClose:")",tail:"end",placeholder:"-- your code here"},duktape:{headOpen:"function(",headClose:") {",tail:"}",placeholder:"// your code here"}}[lang],Root=function(a){function b(a){_classCallCheck(this,b);a=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a));a.state={gens:{0:{type:"initial",children:[],id:0}},head:0,newQuery:{args:[],code:""}};return a}_inherits(b,a);_createClass(b,[{key:"setQuery",value:function(a){this.setState({newQuery:Object.assign({},
this.state.newQuery,a)})}},{key:"mergeInTransaction",value:function(a){var b=this.state,c=b.gens;b=b.head;var d=c[a.result.gen];a.children=d?d.children:[];a.type="gen";a.id=a.result.gen;c[a.result.parent]||(c[a.result.parent]={result:{gen:a.result.parent},query:{},children:[],type:"gen",id:a.result.parent});d=c[a.result.parent];0===d.children.filter(function(b){return b.id===a.id}).length&&(d.children.push(a),d.children.sort(function(a,b){return a.id-b.id}));this.setState({gens:_defineProperty(Object.assign({},
c),a.result.gen,a),head:b<a.id&&!a.result.error?a.id:b})}},{key:"doQuery",value:function(){var a=this,b=this.state,g=b.head;b=b.newQuery;var d=b.code,f=b.args.reduce(function(a,b){if(!validJSON(b.value))return a[b.name]="invalid json!",a;a[b.name]=JSON.parse(b.value);return a},{});fetch("/eval/"+dbname,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d,args:f,gen:g})}).then(function(a){return a.json()}).then(function(b){a.mergeInTransaction({query:{args:f,code:d,
gen:g},result:b})});this.setQuery({code:"",args:[]})}},{key:"componentWillMount",value:function(){var a=this;(new EventSource("/tail/"+dbname)).addEventListener("transac",function(b){b=JSON.parse(b.data);a.mergeInTransaction(b)})}},{key:"render",value:function(){var a=this.state;return e(Entry,{gen:a.gens[0],head:a.head,newQuery:a.newQuery,setQuery:this.setQuery.bind(this),doQuery:this.doQuery.bind(this)})}}]);return b}(React.Component),Timeline=function(a){return e("div",{className:"timeline fork"},
e(Entry,a))},Entry=function Entry(a){var c=a.gen,k=c.result,g=c.query,d=c.children,f=c.id,h=a.head,l=a.newQuery,m=a.setQuery,n=a.doQuery;return["initial"===c.type?e(InitialGen,{key:f}):e(Gen,{result:k,query:g,key:f})].concat(_toConsumableArray(d.map(function(a,c,k){return e(c!==k.length-1||f===h?Timeline:Entry,{gen:a,head:h,key:a.id,newQuery:l,setQuery:m,doQuery:n})})),[f===h?e(Input,{key:"input-"+h,newQuery:l,setQuery:m,doQuery:n}):void 0])},Input=function(a){function b(){_classCallCheck(this,b);
return _possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}_inherits(b,a);_createClass(b,[{key:"componentDidMount",value:function(){this.textarea&&this.textarea.focus();this.entry&&this.entry.scrollIntoView()}},{key:"render",value:function(){var a=this;return e("div",{className:"entry athead",ref:function(b){return a.entry=b}},e("div",{className:"query"},e("div",{className:"query-box"},e(EditArgs,{args:this.props.newQuery.args,setQuery:this.props.setQuery}),e("textarea",{className:"query-code",
rows:1,key:"query",placeholder:funcSyntax.placeholder,ref:function(b){a.textarea=b},value:this.props.newQuery.code,onChange:function(b){a.textarea&&(b=a.textarea.value.split("\n").length,a.textarea.attributes.rows.value<b&&(a.textarea.attributes.rows.value=b),a.props.setQuery({code:a.textarea.value}))},onKeyPress:function(b){"Enter"===b.key&&b.ctrlKey&&a.props.doQuery()}}),e("div",{className:"func-head"},funcSyntax.tail)),e("button",{className:"go-query",onClick:function(){a.props.doQuery()}},"\u00a0go\u00a0")))}}]);
return b}(React.Component),validJSON=function(a){try{JSON.parse(a)}catch(b){return!1}return!0},validArg=function(a){return!!a.match(/^[a-zA-Z][a-zA-Z0-9]*$/)},Args=function(a){var b=a.args;return e("div",{className:"func-head"},funcSyntax.headOpen,Object.keys(b).map(function(a){return a+" = "+JSON.stringify(b[a])}).join(", "),funcSyntax.headClose)},ArgInput=function(a){function b(){_classCallCheck(this,b);return _possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}_inherits(b,
a);_createClass(b,[{key:"componentDidMount",value:function(){this.nameInput&&this.nameInput.focus()}},{key:"render",value:function(){var a=this,b=this.props,g=b.a,d=b.i,f=b.arr,h=b.setQuery;return e("span",{key:d},e("input",{type:"text",key:"key-"+d,placeholder:"name",ref:function(b){return a.nameInput=b},className:"arg"+(validArg(g.name)?"":" err"),size:4<g.name.length?g.name.length:4,value:g.name,onChange:function(a){"="===a.target.value.slice(-1)?document.getElementById("value-"+d).focus():h({args:[].concat(_toConsumableArray(f.slice(0,
d)),[Object.assign({},g,{name:a.target.value})],_toConsumableArray(f.slice(d+1)))})}})," = ",e("input",{type:"text",key:"value-"+d,id:"value-"+d,placeholder:"json",className:"arg"+(validJSON(g.value)?"":" err"),size:4<g.value.length?g.value.length:4,value:g.value,onChange:function(a){return","===a.target.value.slice(-1)?h({args:[].concat(_toConsumableArray(f),[{name:"",value:""}])}):h({args:[].concat(_toConsumableArray(f.slice(0,d)),[Object.assign({},g,{value:a.target.value})],_toConsumableArray(f.slice(d+
1)))})}}),d!==f.length-1?", ":void 0)}}]);return b}(React.Component),EditArgs=function(a){var b=a.args,c=a.setQuery;return e("div",{className:"func-head"},funcSyntax.headOpen,b.map(function(a,b,d){return e(ArgInput,{key:b,a:a,i:b,arr:d,setQuery:c})}),e("button",{className:"arg",onClick:function(){return c({args:[].concat(_toConsumableArray(b),[{name:"",value:""}])})}},"+"),funcSyntax.headClose)},InitialGen=function(){return e("div",{className:"entry initial-msg"},"initial state")},Gen=function(a){var b=
a.result,c=b.gen,k=b.parent,g=b.walltime,d=b.error,f=b.object;b=b.warm;var h=a.query;a=h.code;h=h.args;return e("div",{className:"entry"+(d?" error":"")},e("div",{className:"query readonly"},e("div",{className:"query-box"},e(Args,{args:h}),e("textarea",{className:"query-code",readOnly:!0,value:a,rows:Math.min(10,a.split("\n").length)}),e("div",{className:"func-head"},funcSyntax.tail))),e("div",{className:"status-line"},"gen: "+c+" | pgen: "+k+" | walltime: "+g/1E6+"ms | "+(b?"warm":"cold"),e(asCode,
{code:a,args:h})),d?e("div",{className:"result error"},JSON.stringify(d,null,2)):e("div",{className:"result"},JSON.stringify(f,null,2)))},asCode=function(a){function b(a){_classCallCheck(this,b);a=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a));a.state={selected:null};return a}_inherits(b,a);_createClass(b,[{key:"render",value:function(){var a=this,b=this.props,g=b.args,d=this.state.selected,f=window.location.protocol+"//"+window.location.host+"/eval/"+dbname;b=JSON.stringify({code:b.code,
args:Object.keys(g).length?g:void 0});b={curl:"curl '".concat(f,"' -H 'Content-Type: application/json' --data '").concat(b,"'"),fetch:'fetch("'.concat(f,'", {\n  method: "POST",\n  headers: { "Content-Type": "application/json" },\n  body: JSON.stringify(').concat(b,"),\n})\n.then(res => res.json())\n.then(res => console.log(res));")};f=null;d&&(f=e("div",{className:"as-code-box",key:"box"},e("pre",{style:{resize:"none",border:"none",width:"100%",whiteSpace:"pre-wrap",cursor:"text"},onClick:function(a){var b=
document.createRange();b.selectNode(a.target);getSelection().removeAllRanges();getSelection().addRange(b)}},b[d])));d=function(b){return function(){return a.setState({selected:a.state.selected===b?null:b})}};return[e("span",{style:{"float":"right"},key:"sp"},"as: ",e("button",{className:"as-code-button",onClick:d("curl")},"cURL"),e("button",{className:"as-code-button",onClick:d("fetch")},"fetch")),f]}}]);return b}(React.Component),dom=document.querySelector("#timeline");ReactDOM.render(e(Root),dom);
