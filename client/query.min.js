var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var d=$jscomp.propertyToPolyfillSymbol[b];if(null==d)return a[b];d=a[d];return void 0!==d?d:a[b]};
$jscomp.polyfill=function(a,b,d,c){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,d,c):$jscomp.polyfillUnisolated(a,b,d,c))};$jscomp.polyfillUnisolated=function(a,b,d,c){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var f=a[c];if(!(f in d))return;d=d[f]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,d,c){var f=a.split(".");a=1===f.length;c=f[0];c=!a&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<f.length-1;h++){var g=f[h];if(!(g in c))return;c=c[g]}f=f[f.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?c[f]:null;b=b(d);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==d&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+f,f=
$jscomp.propertyToPolyfillSymbol[f],$jscomp.defineProperty(c,f,{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,h){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var d=0,c=function(f){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(f||"")+"_"+d++,f)};return c},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),d=0;d<b.length;d++){var c=$jscomp.global[b[d]];"function"===typeof c&&"function"!=typeof c.prototype[a]&&$jscomp.defineProperty(c.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _unsupportedIterableToArray(a,b){if(a){if("string"===typeof a)return _arrayLikeToArray(a,b);var d=Object.prototype.toString.call(a).slice(8,-1);"Object"===d&&a.constructor&&(d=a.constructor.name);if("Map"===d||"Set"===d)return Array.from(a);if("Arguments"===d||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return _arrayLikeToArray(a,b)}}function _iterableToArray(a){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}
function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var d=0,c=Array(b);d<b;d++)c[d]=a[d];return c}function _instanceof(a,b){return null!=b&&"undefined"!==typeof Symbol&&b[Symbol.hasInstance]?!!b[Symbol.hasInstance](a):a instanceof b}
function _typeof(a){"@babel/helpers - typeof";_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};return _typeof(a)}function _classCallCheck(a,b){if(!_instanceof(a,b))throw new TypeError("Cannot call a class as a function");}
function _defineProperties(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}function _createClass(a,b,d){b&&_defineProperties(a.prototype,b);d&&_defineProperties(a,d);return a}
function _inherits(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){_setPrototypeOf=Object.setPrototypeOf||function(d,c){d.__proto__=c;return d};return _setPrototypeOf(a,b)}
function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var d=_getPrototypeOf(a);if(b){var c=_getPrototypeOf(this).constructor;d=Reflect.construct(d,arguments,c)}else d=d.apply(this,arguments);return _possibleConstructorReturn(this,d)}}function _possibleConstructorReturn(a,b){return!b||"object"!==_typeof(b)&&"function"!==typeof b?_assertThisInitialized(a):b}
function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}
function _getPrototypeOf(a){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)};return _getPrototypeOf(a)}function _defineProperty(a,b,d){b in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d;return a}
var e=React.createElement,frag=React.Fragment,funcSyntax={luaval:{headOpen:"function(",headClose:")",tail:"end",placeholder:"-- enter your query here"},duktape:{headOpen:"function(",headClose:") {",tail:"}",placeholder:"// enter your query here"}}[lang],Query=function(a){function b(c){_classCallCheck(this,b);var f=d.call(this,c);_defineProperty(_assertThisInitialized(f),"doQuery",function(h){var g=f.state.newQuery,k=g.code,m=g.args.reduce(function(l,n){if(!validJSON(n.value))return l[n.name]="invalid json!",
l;l[n.name]=JSON.parse(n.value);return l},{});fetch("/eval/"+dbname,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:k,args:m,readonly:h})}).then(function(l){return l.json()}).then(function(l){f.mergeInTransaction({query:{args:m,code:k,readonly:h},result:l})});f.setQuery({code:"",args:[]})});f.state={gens:{0:{type:"initial",children:[],id:0}},head:0,newQuery:{args:[],code:""}};return f}_inherits(b,a);var d=_createSuper(b);_createClass(b,[{key:"setQuery",value:function(c){this.setState({newQuery:Object.assign({},
this.state.newQuery,c)})}},{key:"mergeInTransaction",value:function(c){var f=this.state,h=f.gens;f=f.head;var g=h[c.result.gen];c.children=g?g.children:[];c.type="gen";c.id=c.result.gen;h[c.result.parent]||(h[c.result.parent]={result:{gen:c.result.parent},query:{},children:[],type:"gen",id:c.result.parent});g=h[c.result.parent];0===g.children.filter(function(k){return k.id===c.id}).length&&(g.children.push(c),g.children.sort(function(k,m){return k.id-m.id}));this.setState({gens:_defineProperty(Object.assign({},
h),c.result.gen,c),head:f<c.id&&!c.result.error&&!c.query.readonly?c.id:f})}},{key:"componentWillMount",value:function(){var c=this;(new EventSource("/tail/"+dbname)).addEventListener("transac",function(f){f=JSON.parse(f.data);c.mergeInTransaction(f)})}},{key:"render",value:function(){var c=this.state;return e(Entry,{gen:c.gens[0],head:c.head,newQuery:c.newQuery,setQuery:this.setQuery.bind(this),doQuery:this.doQuery.bind(this)})}}]);return b}(React.Component),Timeline=function(a){return e("div",{className:"timeline fork"},
e(Entry,a))},Entry=function Entry(a){var d=a.gen,c=d.result,f=d.query,h=d.children,g=d.id,k=a.head,m=a.newQuery,l=a.setQuery,n=a.doQuery;return["initial"===d.type?e(InitialGen,{key:g}):e(Gen,{result:c,query:f,key:g})].concat(_toConsumableArray(h.map(function(p,q,r){return e(q!==r.length-1||g===k?Timeline:Entry,{gen:p,head:k,key:p.id,newQuery:m,setQuery:l,doQuery:n})})),[g===k?e(Input,{key:"input-"+k,newQuery:m,setQuery:l,doQuery:n}):void 0])},Input=function(a){function b(){_classCallCheck(this,b);
return d.apply(this,arguments)}_inherits(b,a);var d=_createSuper(b);_createClass(b,[{key:"componentDidMount",value:function(){this.textarea&&this.textarea.focus();this.entry&&this.entry.scrollIntoView()}},{key:"render",value:function(){var c=this,f=this.props.doQuery,h=function(){return f(!1)};return e("div",{className:"entry athead",ref:function(g){return c.entry=g}},e("div",{className:"query"},e("div",{className:"query-box",style:{position:"relative"}},e(EditArgs,{args:this.props.newQuery.args,
setQuery:this.props.setQuery}),e("textarea",{className:"query-code",rows:2,key:"query",placeholder:funcSyntax.placeholder,ref:function(g){c.textarea=g},value:this.props.newQuery.code,onChange:function(g){c.textarea&&(g=c.textarea.value.split("\n").length,c.textarea.attributes.rows.value<g&&(c.textarea.attributes.rows.value=g),c.props.setQuery({code:c.textarea.value}))},onKeyPress:function(g){"Enter"===g.key&&g.ctrlKey&&h()}}),e("div",{className:"func-head"},funcSyntax.tail),e("div",{style:{position:"absolute",
right:0,bottom:0,display:"flex",alignItems:"center"}})),e("div",{className:"q-buttons"},e("button",{className:"read-btn q-btn",onClick:function(){return f(!0)}},"read"),e("button",{className:"write-btn q-btn",onClick:h},"write"))))}}]);return b}(React.Component),validJSON=function(a){try{JSON.parse(a)}catch(b){return!1}return!0},validArg=function(a){return!!a.match(/^[a-zA-Z][a-zA-Z0-9]*$/)},Args=function(a){var b=a.args;return e("div",{className:"func-head"},funcSyntax.headOpen,Object.keys(b).map(function(d){return d+
" = "+JSON.stringify(b[d])}).join(", "),funcSyntax.headClose)},ArgInput=function(a){function b(){_classCallCheck(this,b);return d.apply(this,arguments)}_inherits(b,a);var d=_createSuper(b);_createClass(b,[{key:"componentDidMount",value:function(){this.nameInput&&this.nameInput.focus()}},{key:"render",value:function(){var c=this,f=this.props,h=f.a,g=f.i,k=f.arr,m=f.setQuery;return e("span",{key:g},e("input",{type:"text",key:"key-"+g,placeholder:"name",ref:function(l){return c.nameInput=l},className:"arg"+
(validArg(h.name)?"":" err"),size:4<h.name.length?h.name.length:4,value:h.name,onChange:function(l){"="===l.target.value.slice(-1)?document.getElementById("value-"+g).focus():m({args:[].concat(_toConsumableArray(k.slice(0,g)),[Object.assign({},h,{name:l.target.value})],_toConsumableArray(k.slice(g+1)))})}})," = ",e("input",{type:"text",key:"value-"+g,id:"value-"+g,placeholder:"json",className:"arg"+(validJSON(h.value)?"":" err"),size:4<h.value.length?h.value.length:4,value:h.value,onChange:function(l){return","===
l.target.value.slice(-1)?m({args:[].concat(_toConsumableArray(k),[{name:"",value:""}])}):m({args:[].concat(_toConsumableArray(k.slice(0,g)),[Object.assign({},h,{value:l.target.value})],_toConsumableArray(k.slice(g+1)))})}}),g!==k.length-1?", ":void 0)}}]);return b}(React.Component),EditArgs=function(a){var b=a.args,d=a.setQuery;return e("div",{className:"func-head"},funcSyntax.headOpen,b.map(function(c,f,h){return e(ArgInput,{key:f,a:c,i:f,arr:h,setQuery:d})}),e("button",{className:"arg",onClick:function(){return d({args:[].concat(_toConsumableArray(b),
[{name:"",value:""}])})}},"+"),funcSyntax.headClose)},InitialGen=function(){return e("div",{className:"entry initial-msg"},"initial state")},Gen=function(a){var b=a.result,d=b.gen,c=b.parent,f=b.walltime,h=b.error,g=b.object;b=b.warm;var k=a.query;a=k.code;var m=k.args;k=k.readonly;return e("div",{className:"entry"+(h?" error":"")+(!h&&k?" readonly":"")},e("div",{className:"query readonly"},e("div",{className:"query-box"},e(Args,{args:m}),e("textarea",{className:"query-code",readOnly:!0,value:a,rows:Math.min(10,
a.split("\n").length)}),e("div",{className:"func-head"},funcSyntax.tail))),e("div",{className:"status-line"},"gen: "+d+" | pgen: "+c+" | walltime: "+f/1E6+"ms | "+(b?"warm":"cold")+" | "+(k?"read":"write"),e(asCode,{code:a,args:m})),h?e("div",{className:"result error"},JSON.stringify(h,null,2)):e("div",{className:"result"},JSON.stringify(g,null,2)))},asCode=function(a){function b(c){_classCallCheck(this,b);c=d.call(this,c);c.state={selected:null};return c}_inherits(b,a);var d=_createSuper(b);_createClass(b,
[{key:"render",value:function(){var c=this,f=this.props,h=f.args,g=this.state.selected,k=window.location.protocol+"//"+window.location.host+"/eval/"+dbname;f=JSON.stringify({code:f.code,args:Object.keys(h).length?h:void 0});f={curl:"curl '".concat(k,"' -H 'Content-Type: application/json' --data '").concat(f,"'"),fetch:'fetch("'.concat(k,'", {\n  method: "POST",\n  headers: { "Content-Type": "application/json" },\n  body: JSON.stringify(').concat(f,"),\n})\n.then(res => res.json())\n.then(res => console.log(res));")};
k=null;g&&(k=e("div",{className:"as-code-box",key:"box"},e("pre",{style:{resize:"none",border:"none",width:"100%",whiteSpace:"pre-wrap",cursor:"text"},onClick:function(m){var l=document.createRange();l.selectNode(m.target);getSelection().removeAllRanges();getSelection().addRange(l)}},f[g])));g=function(m){return function(){return c.setState({selected:c.state.selected===m?null:m})}};return[e("span",{style:{"float":"right"},key:"sp"},"as: ",e("button",{className:"as-code-button",onClick:g("curl")},
"cURL"),e("button",{className:"as-code-button",onClick:g("fetch")},"fetch")),k]}}]);return b}(React.Component);
