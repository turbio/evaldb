version: v1.0
name: evaldb
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804

blocks:
  - name: "run tests"
    task:
      jobs:
        - name: run tests
          commands:
            - checkout
            - install-package libjansson-dev
            - change-go-version 1.11
            - go get -v -d -t ./...
            - make
            - make test
        - name: cppcheck
          commands:
            - checkout
            - install-package cppcheck
            - make cppcheck
        - name: valgrind
          commands:
            - checkout
            - install-package valgrind libjansson-dev
            - make luaval
            - make valgrind
